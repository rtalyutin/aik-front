# No-Internet Scripts

Папка содержит код, необходимый только для локальной разработки без интернета.

**Важно:** Локальные фичи (скачивание файлов, локальная авторизация) **выключены по умолчанию**, даже в dev режиме. Они включаются автоматически при запуске `npm run dev:full`.

## Структура

```
no-internet-scripts/
├── components/          # React компоненты для локальной разработки
│   ├── DevOnly.jsx                    # Обертка для условного рендеринга в dev режиме
│   ├── DownloadAllYoutubeVideos.jsx   # Компонент для скачивания всех треков
│   ├── LocalAuthButton.jsx            # Кнопка локальной авторизации
│   └── LocalFileWarning.jsx           # Предупреждение о дубликатах файлов
├── hooks/               # React хуки
│   └── useLocalFileHandler.js         # Хук для обработки локальных файлов
├── utils/               # Утилиты
│   ├── localFileUtils.js              # Утилиты для проверки локальных файлов
│   └── localFileUploadHandler.js      # Обработчик загрузки файлов в downloads
├── server/              # Локальный сервер
│   ├── server.js                      # Express сервер для скачивания/загрузки файлов
│   └── package.json                   # Зависимости сервера
├── downloads/           # Папка для скачанных файлов (создается автоматически)
├── index.js            # Главный файл экспортов
└── README.md           # Этот файл
```

## Компоненты

### `DevOnlyDownloadAllYoutubeVideos`
Компонент-обертка для условного рендеринга `DownloadAllYoutubeVideos` только в dev режиме.

### `DownloadAllYoutubeVideos`
Компонент для скачивания всех треков с прямыми ссылками из конфига в папку `downloads/`.

Файлы сохраняются с именами на основе ID трека (например, `Zero_People_-_Счастье.mp4`), что обеспечивает надежное сопоставление при воспроизведении.

### `LocalAuthButton`
Кнопка "Я свой, пусти" для локальной авторизации без интернета.

### `LocalFileWarning`
Предупреждение о том, что файлы с одинаковыми именами будут перезаписаны.

## Хуки

### `useLocalFileHandler`
Хук для обработки локальных файлов:
- Проверяет наличие файлов в `downloads/` при ошибках загрузки
- Автоматически заменяет URL на локальный путь, если файл найден
- Обрабатывает ошибки загрузки видео

## Утилиты

### `checkLocalFile(track, localFileMap, setLocalFileMap)`
Проверяет наличие локального файла для трека в папке `downloads/`.

### `saveFilesToDownloads(files)`
Сохраняет файлы на локальный сервер в папку `downloads/`.

## Сервер

Локальный Express сервер (`server/server.js`) для:
- Скачивания файлов по URL и сохранения в `downloads/`
- Загрузки файлов через форму и сохранения в `downloads/`
- Проверки наличия файлов в `downloads/` (по точному имени или поиск по части имени)
- Отдачи файлов из `downloads/` для воспроизведения
- Автоматической очистки неполных файлов (`.tmp`) при запуске

**Важно:** Сервер работает только для локальной разработки и не должен использоваться в продакшене!

### Установка зависимостей

При первом запуске нужно установить зависимости сервера:

```bash
cd no-internet-scripts/server
npm install
```

### Запуск сервера

Из корня проекта:

```bash
npm run local-server
```

Или вместе с фронтендом:

```bash
npm run dev:full
```

Эта команда автоматически запустит:
- Локальный сервер на `localhost:3001` для скачивания/загрузки файлов
- Vite dev server на `localhost:5174` (порт изменен, чтобы можно было запустить версию без изменений на 5173)

## Включение/выключение локальных фич

Локальные фичи (скачивание файлов, локальная авторизация, предупреждения) **выключены по умолчанию**.

### Команды для запуска:

- **`npm run dev`** — запускает только фронтенд **БЕЗ** локальных фич (чистый вид, как на проде)
- **`npm run dev:full`** — запускает фронтенд **С** локальными фичами + локальный сервер для скачивания файлов

### Ручное управление (опционально):

Если нужно включить локальные фичи при обычном `npm run dev`:

1. Откройте файл `.env` в корне проекта
2. Добавьте строку:
   ```
   VITE_ENABLE_LOCAL_FEATURES=true
   ```
3. Перезапустите dev сервер

**Примечание:** 
- В продакшене локальные фичи всегда выключены (не зависят от переменной окружения)
- Команда `npm run dev:full` автоматически включает локальные фичи через переменную окружения

## Использование

Все компоненты, хуки и утилиты экспортируются через `index.js`:

```javascript
import {
  DevOnlyDownloadAllYoutubeVideos,
  LocalAuthButton,
  LocalFileWarning,
  useLocalFileHandler,
  saveFilesToDownloads,
  checkLocalFile,
  isLocalFeaturesEnabled,
} from '../../../no-internet-scripts/index.js';
```
