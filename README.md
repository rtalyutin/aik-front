# AIK Front — SPA панели управления клубом

Одностраничное приложение на React, которое собирает новости, расписание и данные команд спортивного клуба AIK Front. Проект
поставляется с настроенной инфраструктурой качества кода, проверками CI/CD, документацией и PWA-режимом для офлайн-доступа.

## Содержание

- [Технический стек](#технический-стек)
- [Структура каталогов](#структура-каталогов)
- [Переменные окружения](#переменные-окружения)
- [Сетевой слой и схемы API](#сетевой-слой-и-схемы-api)
- [Хуки управления данными](#хуки-управления-данными)
- [UI-компоненты и фичи](#ui-компоненты-и-фичи)
- [Скрипты npm](#скрипты-npm)
- [Тестирование и качество](#тестирование-и-качество)
- [PWA и офлайн-режим](#pwa-и-офлайн-режим)
- [CI/CD](#cicd)
- [Добавление новой фичи](#добавление-новой-фичи)
- [Правила коммитов и PR](#правила-коммитов-и-pr)

## Технический стек

- **React 18** + **React Router 6**
- **@tanstack/react-query** для кэширования и повторных запросов
- **Axios** + **Zod** для работы с REST API и валидации
- **ESLint 9** + **Prettier** + плагины `jsx-a11y`, `security`
- **Jest** + **Testing Library** + **MSW** для unit и интеграционных тестов
- **Vite 5** с плагином **vite-plugin-pwa**

## Структура каталогов

```
src/
├── api/                # http-клиент и модули доступа к REST API
├── components/         # общие UI-компоненты (карточки, уведомления и пр.)
├── hooks/              # обёртки поверх React Query с fallback-логикой
├── layouts/            # каркас приложения и глобальные элементы
├── news|schedule|teams/ # feature-based каталоги с компонентами и fallback-конфигами
├── pages/              # ленивые страницы для маршрутов
├── pwa/                # регистрация service worker
├── utils/              # вспомогательные функции (форматирование дат, логгер)
└── router.jsx          # конфигурация маршрутизатора
```

## Переменные окружения

Все переменные задаются через файл `.env` (см. `.env.example`).

| Ключ                   | Назначение                                                       |
| ---------------------- | ---------------------------------------------------------------- |
| `VITE_API_BASE_URL`    | Базовый URL бэкенд-API (например, `https://api.aik-front.test`). |
| `VITE_REQUEST_TIMEOUT` | Таймаут HTTP-запросов в миллисекундах (по умолчанию 8000).       |

Документация по окружению актуальна для всех сред: dev/stage/prod. Не забудьте синхронизировать `.env` при деплое.

## Сетевой слой и схемы API

- `src/api/httpClient.js` — настроенный экземпляр Axios с обработкой ошибок и таймаутов. Ошибки нормализуются в `ApiError` и
  логируются.
- `src/api/news.js`, `schedule.js`, `teams.js` — обёртки над эндпоинтами `/news`, `/schedule`, `/teams`. Данные проверяются с
  помощью схем Zod; при несоответствии выбрасывается `ApiError`.

### Пример ожидаемого ответа `/news`

```json
{
  "items": [
    {
      "id": "preseason-camp",
      "title": "AIK выходит на предсезонный сбор",
      "summary": "...",
      "publishedAt": "2025-02-01T09:00:00.000Z",
      "link": "https://...",
      "tags": ["команда"]
    }
  ]
}
```

Формат `/schedule` и `/teams` аналогичен: API может вернуть либо объект `{ items: [...] }`, либо чистый массив.

## Хуки управления данными

Общий хук `useApiResource` оборачивает React Query, добавляя:

- повторные попытки запроса и кэш (по умолчанию 60 секунд);
- fallback на статические JSON-конфиги при сетевой ошибке (`src/news/config.json` и т.д.);
- логирование ошибок через `src/utils/logger.js`.

Специализированные хуки `useNews`, `useSchedule`, `useTeams` подключают соответствующие API-модули и fallback-данные. Компоненты
получают признак `isFallback`, чтобы отрисовать уведомление пользователю.

## UI-компоненты и фичи

- Общие компоненты (`src/components/`) включают карточки, секции, индикаторы загрузки и сообщения об ошибках.
- Фичи (`src/news`, `src/schedule`, `src/teams`) имеют собственные компоненты, стили и `config.json` для офлайн-режима.
- Главная страница объединяет все блоки; отдельные маршруты `/news`, `/schedule`, `/teams` подгружаются лениво.
- Для SEO и доступности используются `react-helmet-async` и `eslint-plugin-jsx-a11y`.

## Скрипты npm

| Скрипт                                          | Описание                             |
| ----------------------------------------------- | ------------------------------------ |
| `npm run dev`                                   | Локальная разработка на Vite.        |
| `npm run build`                                 | Сборка production-бандла.            |
| `npm run preview`                               | Предпросмотр собранного приложения.  |
| `npm run lint` / `lint:fix`                     | Проверка ESLint и автопочинка.       |
| `npm run format` / `format:check`               | Форматирование Prettier.             |
| `npm run test` / `test:watch` / `test:coverage` | Запуск Jest-тестов.                  |
| `npm run audit`                                 | Проверка зависимостей на уязвимости. |

Husky + lint-staged запускают `eslint` и `prettier` перед коммитом.

## Тестирование и качество

- Unit-тесты для схем и общего хука `useApiResource` (`src/api/__tests__`, `src/hooks/__tests__`).
- Для имитации ответов REST API в тестах применяются простые моки без сторонних рантаймов.
- Покрытие собирается командой `npm run test -- --coverage` и публикуется в CI.
- ESLint включает правила доступности и безопасности (`eslint-plugin-security`).

## PWA и офлайн-режим

- `vite-plugin-pwa` генерирует service worker, кеширует статику и ответы API `/news` и `/schedule`.
- `src/pwa/registerSW.js` регистрирует worker (режим `autoUpdate`).
- В каталоге `public/` лежат `manifest.webmanifest` и иконки 192/512 px.

## CI/CD

Workflow `.github/workflows/ci.yml` выполняет линт, форматирование, тесты, сборку и `npm audit` на каждое изменение в ветках
`main`, `develop`, `feature/*`, `bugfix/*` и в pull request.

## Добавление новой фичи

1. Создайте ветку `feature/<ticket>-<alias>`.
2. Сгенерируйте директорию `src/<feature>/` со структурой:
   - `FeatureSection.jsx` — главный компонент, использующий `Section` и бизнес-логику.
   - `config.json` — fallback-данные.
   - `feature.module.css` — стили.
3. Реализуйте API-модуль `src/api/<feature>.js` c валидацией Zod и экспортом `QUERY_KEY`.
4. Создайте хук `src/hooks/use<Feature>.js`, подключающий API и fallback.
5. Зарегистрируйте маршрут в `src/router.jsx` и добавьте блок на нужные страницы.
6. Напишите unit-тесты для схем/хуков и обновите документацию при изменении формата данных.

## Правила коммитов и PR

- Используйте Conventional Commits (`feat:`, `fix:`, `chore:`, `docs:` и т.д.).
- Каждое изменение проходит через pull request с заполненным описанием: что изменено, как тестировалось.
- Для крупных задач дробите изменения на несколько PR.
